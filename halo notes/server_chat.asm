;notes by Jesus7Freak
;haloce1.09 chat="test"

;server receive and send function

004AE040   8B08             MOV ECX,DWORD PTR DS:[EAX];[0018CA88]->ECX=0018CAD4
004AE042   8B11             MOV EDX,DWORD PTR DS:[ECX];->EDX=00000000 ;player index?
004AE044   81EC 24020000    SUB ESP,224
004AE04A   57               PUSH EDI
004AE04B   33FF             XOR EDI,EDI
004AE04D   3BD7             CMP EDX,EDI
004AE04F   0F85 E5010000    JNZ haloce.004AE23A
004AE055   8D5424 28        LEA EDX,DWORD PTR SS:[ESP+28] ;chat buffer->EDX=0018C870
004AE059   8D4C24 08        LEA ECX,DWORD PTR SS:[ESP+8] ;->ECX=0018C850 ptr to chat info { int chat_type, char from_player_chat_index, wchar_t* msg_str}
004AE05D   897C24 08        MOV DWORD PTR SS:[ESP+8],EDI  ;chat type: Global = 0, Team = 1, Vehicle = 2, Server = 3
004AE061   C64424 0C FF     MOV BYTE PTR SS:[ESP+C],0FF
004AE066   895424 10        MOV DWORD PTR SS:[ESP+10],EDX
004AE06A   E8 B1210400      CALL haloce.004F0220;get text, store in local buffer 0018C870 L"test"
004AE06F   84C0             TEST AL,AL
004AE071   0F84 12010000    JE haloce.004AE189
004AE077   8B8424 2C020000  MOV EAX,DWORD PTR SS:[ESP+22C] ;[0018CA74]first paramter->EAX=007FC738
004AE07E   E8 FD630300      CALL haloce.004E4480;nop this to block chat   5C5C7990
->
 004E4480   0FBF40 0C        MOVSX EAX,WORD PTR DS:[EAX+C] ;player index -> EAX
 004E4484   57               PUSH EDI
 004E4485   83CF FF          OR EDI,FFFFFFFF
 004E4488   83F8 FF          CMP EAX,-1 ;valid index?
 004E448B   74 2E            JE SHORT haloce.004E44BB
 004E448D   25 FFFF0000      AND EAX,0FFFF
 004E4492   8D0485 B0C36400  LEA EAX,DWORD PTR DS:[EAX*4+64C3B0]
 004E4499   85C0             TEST EAX,EAX                             ; haloce.0064C3B4
 004E449B   74 1E            JE SHORT haloce.004E44BB
 004E449D   8B10             MOV EDX,DWORD PTR DS:[EAX] ;player tag (not obj tag)
 004E449F   83FA FF          CMP EDX,-1
 004E44A2   74 17            JE SHORT haloce.004E44BB
 004E44A4   56               PUSH ESI                                 ; haloce.007FC798
 004E44A5   8B35 C0558100    MOV ESI,DWORD PTR DS:[8155C0] ;"players"
 004E44AB   E8 10F7FEFF      CALL haloce.004D3BC0
 ->
  004D3BC0   33C0             XOR EAX,EAX                              ; haloce.0064C3B4
  004D3BC2   83FA FF          CMP EDX,-1 ;valid tag?
  004D3BC5   74 33            JE SHORT haloce.004D3BFA
  004D3BC7   57               PUSH EDI
  004D3BC8   8BFA             MOV EDI,EDX                              ; player index
  004D3BCA   C1FF 10          SAR EDI,10
  004D3BCD   66:85D2          TEST DX,DX
  004D3BD0   7C 27            JL SHORT haloce.004D3BF9
  004D3BD2   66:3B56 20       CMP DX,WORD PTR DS:[ESI+20];MaxItems
  004D3BD6   7D 21            JGE SHORT haloce.004D3BF9
  004D3BD8   0FBF4E 22        MOVSX ECX,WORD PTR DS:[ESI+22];ItemSize 200 for each static player
  004D3BDC   0FBFD2           MOVSX EDX,DX
  004D3BDF   0FAFCA           IMUL ECX,EDX
  004D3BE2   034E 34          ADD ECX,DWORD PTR DS:[ESI+34];ItemArray_ptr @ 402AAFCC
  004D3BE5   66:8B11          MOV DX,WORD PTR DS:[ECX]
  004D3BE8   66:85D2          TEST DX,DX
  004D3BEB   74 0C            JE SHORT haloce.004D3BF9
  004D3BED   66:85FF          TEST DI,DI
  004D3BF0   74 05            JE SHORT haloce.004D3BF7
  004D3BF2   66:3BD7          CMP DX,DI
  004D3BF5   75 02            JNZ SHORT haloce.004D3BF9
  004D3BF7   8BC1             MOV EAX,ECX ;ret static player pointer
  004D3BF9   5F               POP EDI
  004D3BFA   C3               RETN 
 <-
 004E44B0   85C0             TEST EAX,EAX;test pointer
 004E44B2   5E               POP ESI
 004E44B3   74 06            JE SHORT haloce.004E44BB
 004E44B5   0FBE40 67        MOVSX EAX,BYTE PTR DS:[EAX+67];static player + 0x67 
 004E44B9   5F               POP EDI
 004E44BA   C3               RETN
 ;004E44BB   8BC7             MOV EAX,EDI
 ;004E44BD   5F               POP EDI
 ;004E44BE   C3               RETN
 ;004E44BF   CC               INT3
 ;004E44C0   83EC 18          SUB ESP,18
 ;004E44C3   55               PUSH EBP
 ;004E44C4   8B6C24 20        MOV EBP,DWORD PTR SS:[ESP+20]
 ;004E44C8   8A4D 06          MOV CL,BYTE PTR SS:[EBP+6]
 ;004E44CB   32C0             XOR AL,AL
 ;004E44CD   F6C1 01          TEST CL,1
 ;004E44D0   0F84 9B010000    JE haloce.004E4671
 ;004E44D6   53               PUSH EBX
 ;004E44D7   33DB             XOR EBX,EBX
 ;004E44D9   8D85 04040000    LEA EAX,DWORD PTR SS:[EBP+404]
 ;004E44DF   90               NOP
 ;004E44E0   66:8338 FF       /CMP WORD PTR DS:[EAX],0FFFF
 ;004E44E4   74 11            |JE SHORT haloce.004E44F7
 ;004E44E6   43               |INC EBX
 ;004E44E7   83C0 60          |ADD EAX,60
 ;004E44EA   83FB 10          |CMP EBX,10
 ;004E44ED  ^7C F1            \JL SHORT haloce.004E44E0
 ;004E44EF   5B               POP EBX
 ;004E44F0   32C0             XOR AL,AL
 ;004E44F2   5D               POP EBP
 ;004E44F3   83C4 18          ADD ESP,18
 ;004E44F6   C3               RETN
 ;004E44F7   8B5424 28        MOV EDX,DWORD PTR SS:[ESP+28]
 ;004E44FB   33C0             XOR EAX,EAX
 ;004E44FD   56               PUSH ESI
 ;004E44FE   33C9             XOR ECX,ECX
 ;004E4500   57               PUSH EDI
 ;004E4501   8B3A             MOV EDI,DWORD PTR DS:[EDX]
 ;004E4503   85FF             TEST EDI,EDI
 ;004E4505   894424 14        MOV DWORD PTR SS:[ESP+14],EAX
 ;004E4509   894424 18        MOV DWORD PTR SS:[ESP+18],EAX
 ;004E450D   894C24 20        MOV DWORD PTR SS:[ESP+20],ECX
 ;004E4511   C74424 10 000000>MOV DWORD PTR SS:[ESP+10],0
 ;004E4519   894424 1C        MOV DWORD PTR SS:[ESP+1C],EAX
 ;004E451D   894C24 24        MOV DWORD PTR SS:[ESP+24],ECX
 ;004E4521   74 28            JE SHORT haloce.004E454B
 ;004E4523   8D7424 10        LEA ESI,DWORD PTR SS:[ESP+10]
 ;004E4527   E8 B4D7F5FF      CALL haloce.00441CE0
 ;004E452C   66:85C0          TEST AX,AX
 ;004E452F   74 34            JE SHORT haloce.004E4565
 ;004E4531   33C9             XOR ECX,ECX
 ;004E4533   8BC1             MOV EAX,ECX
 ;004E4535   894C24 14        MOV DWORD PTR SS:[ESP+14],ECX
 ;004E4539   894C24 18        MOV DWORD PTR SS:[ESP+18],ECX
 ;004E453D   894C24 1C        MOV DWORD PTR SS:[ESP+1C],ECX
 ;004E4541   894C24 20        MOV DWORD PTR SS:[ESP+20],ECX
 ;004E4545   894C24 24        MOV DWORD PTR SS:[ESP+24],ECX
 ;004E4549   EB 1E            JMP SHORT haloce.004E4569
 ;004E454B   33D2             XOR EDX,EDX
 ;004E454D   8BC2             MOV EAX,EDX
 ;004E454F   895424 14        MOV DWORD PTR SS:[ESP+14],EDX
 ;004E4553   895424 18        MOV DWORD PTR SS:[ESP+18],EDX
 ;004E4557   895424 1C        MOV DWORD PTR SS:[ESP+1C],EDX
 ;004E455B   895424 20        MOV DWORD PTR SS:[ESP+20],EDX
 ;004E455F   895424 24        MOV DWORD PTR SS:[ESP+24],EDX
 ;004E4563   EB 04            JMP SHORT haloce.004E4569
 ;004E4565   8B4424 10        MOV EAX,DWORD PTR SS:[ESP+10]
 ;004E4569   33C9             XOR ECX,ECX
 ;004E456B   3BC1             CMP EAX,ECX
 ;004E456D   0F84 F9000000    JE haloce.004E466C
 ;004E4573   8A15 8C736B00    MOV DL,BYTE PTR DS:[6B738C]
 ;004E4579   84D2             TEST DL,DL
 ;004E457B   75 13            JNZ SHORT haloce.004E4590
 ;004E457D   3D 0100007F      CMP EAX,7F000001
 ;004E4582   74 0C            JE SHORT haloce.004E4590
 ;004E4584   3B05 741F6200    CMP EAX,DWORD PTR DS:[621F74]
 ;004E458A   0F85 DC000000    JNZ haloce.004E466C
 ;004E4590   8B5424 30        MOV EDX,DWORD PTR SS:[ESP+30]
 ;004E4594   8D045B           LEA EAX,DWORD PTR DS:[EBX+EBX*2]
 ;004E4597   C1E0 05          SHL EAX,5
 ;004E459A   03C5             ADD EAX,EBP
 ;004E459C   8990 F8030000    MOV DWORD PTR DS:[EAX+3F8],EDX
 ;004E45A2   8988 0C040000    MOV DWORD PTR DS:[EAX+40C],ECX
 ;004E45A8   8988 10040000    MOV DWORD PTR DS:[EAX+410],ECX
 ;004E45AE   8DB0 F8030000    LEA ESI,DWORD PTR DS:[EAX+3F8]
 ;004E45B4   33C9             XOR ECX,ECX
 ;004E45B6   8D90 4A040000    LEA EDX,DWORD PTR DS:[EAX+44A]
 ;004E45BC   66:8998 04040000 MOV WORD PTR DS:[EAX+404],BX
 ;004E45C3   66:C780 06040000>MOV WORD PTR DS:[EAX+406],1
 ;004E45CC   C680 08040000 00 MOV BYTE PTR DS:[EAX+408],0
 ;004E45D3   C680 48040000 00 MOV BYTE PTR DS:[EAX+448],0
 ;004E45DA   C680 49040000 00 MOV BYTE PTR DS:[EAX+449],0
 ;004E45E1   890A             MOV DWORD PTR DS:[EDX],ECX
 ;004E45E3   894A 04          MOV DWORD PTR DS:[EDX+4],ECX
 ;004E45E6   8B15 98736B00    MOV EDX,DWORD PTR DS:[6B7398]
 ;004E45EC   8BCA             MOV ECX,EDX
 ;004E45EE   42               INC EDX
 ;004E45EF   83F9 FF          CMP ECX,-1
 ;004E45F2   8915 98736B00    MOV DWORD PTR DS:[6B7398],EDX
 ;004E45F8   75 09            JNZ SHORT haloce.004E4603
 ;004E45FA   8BCA             MOV ECX,EDX
 ;004E45FC   42               INC EDX
 ;004E45FD   8915 98736B00    MOV DWORD PTR DS:[6B7398],EDX
 ;004E4603   8988 54040000    MOV DWORD PTR DS:[EAX+454],ECX
 ;004E4609   8B45 00          MOV EAX,DWORD PTR SS:[EBP]
 ;004E460C   8B88 9C0A0000    MOV ECX,DWORD PTR DS:[EAX+A9C]
 ;004E4612   8B4424 30        MOV EAX,DWORD PTR SS:[ESP+30]
 ;004E4616   8B00             MOV EAX,DWORD PTR DS:[EAX]
 ;004E4618   E8 23D4F5FF      CALL haloce.00441A40
 ;004E461D   66:8BD8          MOV BX,AX
 ;004E4620   66:F7DB          NEG BX
 ;004E4623   1ADB             SBB BL,BL
 ;004E4625   FEC3             INC BL
 ;004E4627   85F6             TEST ESI,ESI
 ;004E4629   74 10            JE SHORT haloce.004E463B
 ;004E462B   8B06             MOV EAX,DWORD PTR DS:[ESI]
 ;004E462D   85C0             TEST EAX,EAX
 ;004E462F   74 0A            JE SHORT haloce.004E463B
 ;004E4631   8A88 980A0000    MOV CL,BYTE PTR DS:[EAX+A98]
 ;004E4637   84C9             TEST CL,CL
 ;004E4639   75 0A            JNZ SHORT haloce.004E4645
 ;004E463B   8A85 4F0A0000    MOV AL,BYTE PTR SS:[EBP+A4F]
 ;004E4641   84C0             TEST AL,AL
 ;004E4643   75 14            JNZ SHORT haloce.004E4659
 ;004E4645   56               PUSH ESI
 ;004E4646   55               PUSH EBP
 ;004E4647   E8 94FAFFFF      CALL haloce.004E40E0
 ;004E464C   83C4 08          ADD ESP,8
 ;004E464F   5F               POP EDI
 ;004E4650   5E               POP ESI
 ;004E4651   8AC3             MOV AL,BL
 ;004E4653   5B               POP EBX
 ;004E4654   5D               POP EBP
 ;004E4655   83C4 18          ADD ESP,18
 ;004E4658   C3               RETN
 ;004E4659   56               PUSH ESI
 ;004E465A   E8 01FDFFFF      CALL haloce.004E4360
 ;004E465F   83C4 04          ADD ESP,4
 ;004E4662   5F               POP EDI
 ;004E4663   5E               POP ESI
 ;004E4664   8AC3             MOV AL,BL
 ;004E4666   5B               POP EBX
 ;004E4667   5D               POP EBP
 ;004E4668   83C4 18          ADD ESP,18
 ;004E466B   C3               RETN
 ;004E466C   5F               POP EDI
 ;004E466D   5E               POP ESI
 ;004E466E   32C0             XOR AL,AL
 ;004E4670   5B               POP EBX
 ;004E4671   5D               POP EBP
 ;004E4672   83C4 18          ADD ESP,18
 ;004E4675   C3               RETN
 <-
004AE083   83F8 FF          CMP EAX,-1
004AE086   0F84 FD000000    JE haloce.004AE189
004AE08C   53               PUSH EBX
004AE08D   55               PUSH EBP

004AE08E   57               PUSH EDI ;0 param7
004AE08F   6A 01            PUSH 1 ;param6
004AE091   57               PUSH EDI ;0 param5
004AE092   8D4C24 18        LEA ECX,DWORD PTR SS:[ESP+18]  ;->ECX=0018C84C ptr (or ptr ptr?) to chat info 0018C850
004AE096   51               PUSH ECX ;param4
004AE097   884424 24        MOV BYTE PTR SS:[ESP+24],AL ;player chat index AL=00 Stack SS:[0018C854]=00
004AE09B   57               PUSH EDI ;0 param3
004AE09C   8D4424 24        LEA EAX,DWORD PTR SS:[ESP+24] ;Stack address=0018C850 ->EAX=0018C850
004AE0A0   894424 20        MOV DWORD PTR SS:[ESP+20],EAX ;Stack SS:[0018C84C]
004AE0A4   6A 0F            PUSH 0F ;param2
004AE0A6   57               PUSH EDI ;00000000   param1
004AE0A7   BA F87F0000      MOV EDX,7FF8 ;fastcall param
004AE0AC   B8 20CE8000      MOV EAX,haloce.0080CE20 ;fastcall param
004AE0B1   897C24 48        MOV DWORD PTR SS:[ESP+48],EDI ;EDI=00000000 Stack SS:[0018C86C]
004AE0B5   E8 16250400      CALL haloce.004F05D0
->
 004F05D0   81EC A4000000    SUB ESP,0A4
 004F05D6   53               PUSH EBX
 004F05D7   55               PUSH EBP
 004F05D8   8BAC24 BC000000  MOV EBP,DWORD PTR SS:[ESP+BC];->EBP=0018C84C
 004F05DF   33DB             XOR EBX,EBX
 004F05E1   56               PUSH ESI
 004F05E2   8BF0             MOV ESI,EAX ;->ESI=0080CE20
 004F05E4   57               PUSH EDI 
 004F05E5   33C0             XOR EAX,EAX
 004F05E7   885C24 20        MOV BYTE PTR SS:[ESP+20],BL ;BL=00 Stack SS:[0018C78C]
 004F05EB   B9 24000000      MOV ECX,24
 004F05F0   8D7C24 24        LEA EDI,DWORD PTR SS:[ESP+24] ;->EDI=0018C790 set memory to 0
 004F05F4   F3:AB            REP STOS DWORD PTR ES:[EDI]
 004F05F6   8B8C24 BC000000  MOV ECX,DWORD PTR SS:[ESP+BC] ;->ECX=0000000F
 004F05FD   8B048D 40BA5F00  MOV EAX,DWORD PTR DS:[ECX*4+5FBA40] ;->EAX=0062E460
 004F0604   8B40 0C          MOV EAX,DWORD PTR DS:[EAX+C] ;->EAX=00000007
 004F0607   895424 30        MOV DWORD PTR SS:[ESP+30],EDX ;EDX=00007FF8 Stack SS:[0018C79C]=00000000
 004F060B   2BD0             SUB EDX,EAX ;->EDX=00007FF1
 004F060D   894C24 24        MOV DWORD PTR SS:[ESP+24],ECX ;Stack SS:[0018C790]
 004F0611   8B8C24 B8000000  MOV ECX,DWORD PTR SS:[ESP+B8] ;Stack SS:[0018C824]=00000000->ECX=00000000
 004F0618   895424 38        MOV DWORD PTR SS:[ESP+38],EDX ;EDX=00007FF1 
 004F061C   897424 2C        MOV DWORD PTR SS:[ESP+2C],ESI ;ESI=0080CE20
 004F0620   897424 40        MOV DWORD PTR SS:[ESP+40],ESI ;ESI=0080CE20
 004F0624   8D50 FF          LEA EDX,DWORD PTR DS:[EAX-1] ;->EDX=00000006
 004F0627   8D7424 20        LEA ESI,DWORD PTR SS:[ESP+20] ;->ESI=0018C78C
 004F062B   894C24 28        MOV DWORD PTR SS:[ESP+28],ECX ;ECX=00000000
 004F062F   895C24 34        MOV DWORD PTR SS:[ESP+34],EBX ;00000000
 004F0633   895C24 58        MOV DWORD PTR SS:[ESP+58],EBX ;00000000
 004F0637   894424 5C        MOV DWORD PTR SS:[ESP+5C],EAX ;EAX=00000007
 004F063B   895C24 4C        MOV DWORD PTR SS:[ESP+4C],EBX ;00000000
 004F063F   895C24 48        MOV DWORD PTR SS:[ESP+48],EBX ;00000000
 004F0643   895C24 3C        MOV DWORD PTR SS:[ESP+3C],EBX ;00000000
 004F0647   895C24 44        MOV DWORD PTR SS:[ESP+44],EBX ;00000000
 004F064B   895424 50        MOV DWORD PTR SS:[ESP+50],EDX ;EDX=00000006
 004F064F   894424 54        MOV DWORD PTR SS:[ESP+54],EAX ;EAX=00000007
 004F0653   C64424 20 01     MOV BYTE PTR SS:[ESP+20],1
 004F0658   E8 33030000      CALL haloce.004F0990
 004F065D   8B8424 CC000000  MOV EAX,DWORD PTR SS:[ESP+CC]
 004F0664   3BC3             CMP EAX,EBX
 004F0666   0F8E 25010000    JLE haloce.004F0791
 004F066C   8B9424 C0000000  MOV EDX,DWORD PTR SS:[ESP+C0]
 004F0673   8BB424 C8000000  MOV ESI,DWORD PTR SS:[ESP+C8]
 004F067A   2BD5             SUB EDX,EBP
 004F067C   8BCD             MOV ECX,EBP
 004F067E   2BF5             SUB ESI,EBP
 004F0680   894C24 10        MOV DWORD PTR SS:[ESP+10],ECX
 004F0684   895424 14        MOV DWORD PTR SS:[ESP+14],EDX
 004F0688   897424 1C        MOV DWORD PTR SS:[ESP+1C],ESI
 004F068C   894424 18        MOV DWORD PTR SS:[ESP+18],EAX
 004F0690   EB 0E            JMP SHORT haloce.004F06A0
 004F0692   8B7424 1C        /MOV ESI,DWORD PTR SS:[ESP+1C]
 004F0696   8B5424 14        |MOV EDX,DWORD PTR SS:[ESP+14]
 004F069A   8B4C24 10        |MOV ECX,DWORD PTR SS:[ESP+10]
 004F069E   8BFF             |MOV EDI,EDI
 004F06A0   399C24 C0000000   CMP DWORD PTR SS:[ESP+C0],EBX
 004F06A7   75 04            |JNZ SHORT haloce.004F06AD
 004F06A9   33FF             |XOR EDI,EDI
 004F06AB   EB 03            |JMP SHORT haloce.004F06B0
 004F06AD   8B3C0A           |MOV EDI,DWORD PTR DS:[EDX+ECX]
 004F06B0   399C24 B8000000  |CMP DWORD PTR SS:[ESP+B8],EBX
 004F06B7   8B29             |MOV EBP,DWORD PTR DS:[ECX]
 004F06B9   75 04            |JNZ SHORT haloce.004F06BF
 004F06BB   33F6             |XOR ESI,ESI
 004F06BD   EB 03            |JMP SHORT haloce.004F06C2
 004F06BF   8B340E           |MOV ESI,DWORD PTR DS:[ESI+ECX]
 004F06C2   8D4424 20        |LEA EAX,DWORD PTR SS:[ESP+20]
 004F06C6   E8 25010000      |CALL haloce.004F07F0         ;v
 004F06CB   56               |PUSH ESI
 004F06CC   55               |PUSH EBP
 004F06CD   57               |PUSH EDI
 004F06CE   8D4424 2C        |LEA EAX,DWORD PTR SS:[ESP+2C]
 004F06D2   E8 B9010000      |CALL haloce.004F0890
 004F06D7   8B4424 70        |MOV EAX,DWORD PTR SS:[ESP+70]
 004F06DB   83C4 0C          |ADD ESP,0C
 004F06DE   3BC3             |CMP EAX,EBX
 004F06E0   7F 09            |JG SHORT haloce.004F06EB
 004F06E2   389C24 D0000000  |CMP BYTE PTR SS:[ESP+D0],BL
 004F06E9   74 2D            |JE SHORT haloce.004F0718
 004F06EB   8B4C24 60        |MOV ECX,DWORD PTR SS:[ESP+60]
 004F06EF   8B7C24 34        |MOV EDI,DWORD PTR SS:[ESP+34]
 004F06F3   8B7424 38        |MOV ESI,DWORD PTR SS:[ESP+38]
 004F06F7   8B5424 5C        |MOV EDX,DWORD PTR SS:[ESP+5C]
 004F06FB   03C1             |ADD EAX,ECX
 004F06FD   8B4C24 58        |MOV ECX,DWORD PTR SS:[ESP+58]
 004F0701   03F8             |ADD EDI,EAX
 004F0703   2BF0             |SUB ESI,EAX
 004F0705   03D0             |ADD EDX,EAX
 004F0707   41               |INC ECX
 004F0708   897C24 34        |MOV DWORD PTR SS:[ESP+34],EDI
 004F070C   897424 38        |MOV DWORD PTR SS:[ESP+38],ESI
 004F0710   895424 5C        |MOV DWORD PTR SS:[ESP+5C],EDX
 004F0714   894C24 58        |MOV DWORD PTR SS:[ESP+58],ECX
 004F0718   837C24 28 01     |CMP DWORD PTR SS:[ESP+28],1
 004F071D   75 23            |JNZ SHORT haloce.004F0742
 004F071F   C74424 68 FFFFFF>|MOV DWORD PTR SS:[ESP+68],-1
 004F0727   895C24 6C        |MOV DWORD PTR SS:[ESP+6C],EBX
 004F072B   895C24 70        |MOV DWORD PTR SS:[ESP+70],EBX
 004F072F   895C24 74        |MOV DWORD PTR SS:[ESP+74],EBX
 004F0733   895C24 78        |MOV DWORD PTR SS:[ESP+78],EBX
 004F0737   895C24 7C        |MOV DWORD PTR SS:[ESP+7C],EBX
 004F073B   899C24 80000000  |MOV DWORD PTR SS:[ESP+80],EBX
 004F0742   8B4C24 10        |MOV ECX,DWORD PTR SS:[ESP+10]
 004F0746   8B4424 18        |MOV EAX,DWORD PTR SS:[ESP+18]
 004F074A   83C1 04          |ADD ECX,4
 004F074D   48               |DEC EAX
 004F074E   C78424 84000000 >|MOV DWORD PTR SS:[ESP+84],-1
 004F0759   899C24 88000000  |MOV DWORD PTR SS:[ESP+88],EBX
 004F0760   899C24 8C000000  |MOV DWORD PTR SS:[ESP+8C],EBX
 004F0767   899C24 90000000  |MOV DWORD PTR SS:[ESP+90],EBX
 004F076E   899C24 94000000  |MOV DWORD PTR SS:[ESP+94],EBX
 004F0775   899C24 98000000  |MOV DWORD PTR SS:[ESP+98],EBX
 004F077C   899C24 9C000000  |MOV DWORD PTR SS:[ESP+9C],EBX
 004F0783   894C24 10        |MOV DWORD PTR SS:[ESP+10],ECX
 004F0787   894424 18        |MOV DWORD PTR SS:[ESP+18],EAX
 004F078B  ^0F85 01FFFFFF    \JNZ haloce.004F0692
 004F0791   8B4C24 34        MOV ECX,DWORD PTR SS:[ESP+34]
 004F0795   8B5424 24        MOV EDX,DWORD PTR SS:[ESP+24]
 004F0799   8B3C95 40BA5F00  MOV EDI,DWORD PTR DS:[EDX*4+5FBA40]
 004F07A0   33C0             XOR EAX,EAX
 004F07A2   3BCB             CMP ECX,EBX
 004F07A4   7E 37            JLE SHORT haloce.004F07DD
 004F07A6   8B47 14          MOV EAX,DWORD PTR DS:[EDI+14]
 004F07A9   83F8 01          CMP EAX,1
 004F07AC   7E 28            JLE SHORT haloce.004F07D6
 004F07AE   0FB6B0 27BB5F00  MOVZX ESI,BYTE PTR DS:[EAX+5FBB27]
 004F07B5   8B4424 58        MOV EAX,DWORD PTR SS:[ESP+58]
 004F07B9   48               DEC EAX
 004F07BA   894424 14        MOV DWORD PTR SS:[ESP+14],EAX
 004F07BE   56               PUSH ESI
 004F07BF   8D4C24 18        LEA ECX,DWORD PTR SS:[ESP+18]
 004F07C3   8D4424 40        LEA EAX,DWORD PTR SS:[ESP+40]
 004F07C7   E8 6426FEFF      CALL haloce.004D2E30
 004F07CC   83C4 04          ADD ESP,4
 004F07CF   89B424 AC000000  MOV DWORD PTR SS:[ESP+AC],ESI
 004F07D6   8B47 0C          MOV EAX,DWORD PTR DS:[EDI+C]
 004F07D9   034424 34        ADD EAX,DWORD PTR SS:[ESP+34]
 004F07DD   5F               POP EDI
 004F07DE   5E               POP ESI
 004F07DF   5D               POP EBP
 004F07E0   5B               POP EBX
 004F07E1   81C4 A4000000    ADD ESP,0A4
 004F07E7   C3               RETN
<-
004AE0BA   8B0D 84736B00    MOV ECX,DWORD PTR DS:[6B7384]            ; haloce.007FC340
004AE0C0   8BE8             MOV EBP,EAX ;->EBP=000000AF
004AE0C2   8B4424 2C        MOV EAX,DWORD PTR SS:[ESP+2C] ;[0018C850]->EAX=00000000 chat type
004AE0C6   83C4 1C          ADD ESP,1C
004AE0C9   2BC7             SUB EAX,EDI ;EDI=0 EAX=0
004AE0CB   8BD9             MOV EBX,ECX ;->EBX=007FC340
004AE0CD   0F84 45010000    JE haloce.004AE218 ;jmp if chattype = global 0

;EAX=2

004AE0D3   48               DEC EAX ;->EAX=1                          ; Switch (cases 1..2)
004AE0D4   56               PUSH ESI
004AE0D5   0F84 B6000000    JE haloce.004AE191 ;jmp if chattype = team 1

004AE0DB   48               DEC EAX
004AE0DC   0F85 A4000000    JNZ haloce.004AE186 ;jmp if chattype != vehicle 2

;chat type 2: vehicle
004AE0E2   0FB64C24 18      MOVZX ECX,BYTE PTR SS:[ESP+18] ;Stack SS:[0018C854]=00  player chat index ; Case 2 of switch 004AE0D3
004AE0E7   E8 A4060000      CALL haloce.004AE790 ;get veh obj tag from player index

004AE0EC   83F8 FF          CMP EAX,-1 ;is player in veh?
004AE0EF   894424 10        MOV DWORD PTR SS:[ESP+10],EAX ;EAX=E2A20033 Stack SS:[0018C84C]=0018C850
004AE0F3   0F84 8D000000    JE haloce.004AE186
004AE0F9   A1 C0558100      MOV EAX,DWORD PTR DS:[8155C0] ; "players"
004AE0FE   894424 20        MOV DWORD PTR SS:[ESP+20],EAX ;EAX=402AAF94,  Stack SS:[0018C85C]=C1E4B6AE
004AE102   66:897C24 24     MOV WORD PTR SS:[ESP+24],DI ;player index-> Stack SS:[0018C860]
004AE107   35 72657469      XOR EAX,69746572 ;->EAX=295ECAE6
004AE10C   8D7C24 20        LEA EDI,DWORD PTR SS:[ESP+20] ;->EDI=0018C85C
004AE110   C74424 28 FFFFFF>MOV DWORD PTR SS:[ESP+28],-1 ;-> Stack SS:[0018C864]
004AE118   894424 2C        MOV DWORD PTR SS:[ESP+2C],EAX ;-> Stack SS:[0018C868]
004AE11C   E8 EF590200      CALL haloce.004D3B10 ;get valid staic player ptr and tag
004AE121   8BF0             MOV ESI,EAX ;->ESI=402AAFCC static_player address of p0
004AE123   85F6             TEST ESI,ESI
004AE125   74 5F            JE SHORT haloce.004AE186
004AE127   EB 07            JMP SHORT haloce.004AE130
;004AE129   8DA424 00000000  LEA ESP,DWORD PTR SS:[ESP] more filler
;loops here to send the message to all the players in the vehicle
004AE130   8B4E 34          MOV ECX,DWORD PTR DS:[ESI+34] ;veh obj tag from player->ECX=E3AE013F
004AE133   6A 03            PUSH 3
004AE135   E8 16CA0400      CALL haloce.004FAB50 ;get player obj
->
 004FAB50   57               PUSH EDI
 004FAB51   33FF             XOR EDI,EDI
 004FAB53   83F9 FF          CMP ECX,-1 ;E3AE013F
 004FAB56   74 39            JE SHORT haloce.004FAB91
 004FAB58   56               PUSH ESI
 004FAB59   8BF1             MOV ESI,ECX ;->ESI=E3AE013F
 004FAB5B   C1FE 10          SAR ESI,10 ;->ESI=FFFFE3AE
 004FAB5E   66:85C9          TEST CX,CX ;CX=E3AE
 004FAB61   7C 2D            JL SHORT haloce.004FAB90
 004FAB63   8B15 B0B37F00    MOV EDX,DWORD PTR DS:[7FB3B0] ;"object"
 004FAB69   66:3B4A 20       CMP CX,WORD PTR DS:[EDX+20]
 004FAB6D   7D 21            JGE SHORT haloce.004FAB90
 004FAB6F   0FBF42 22        MOVSX EAX,WORD PTR DS:[EDX+22]
 004FAB73   0FBFC9           MOVSX ECX,CX
 004FAB76   0FAFC1           IMUL EAX,ECX
 004FAB79   0342 34          ADD EAX,DWORD PTR DS:[EDX+34]
 004FAB7C   66:8B08          MOV CX,WORD PTR DS:[EAX]
 004FAB7F   66:85C9          TEST CX,CX
 004FAB82   74 0C            JE SHORT haloce.004FAB90
 004FAB84   66:85F6          TEST SI,SI
 004FAB87   74 05            JE SHORT haloce.004FAB8E
 004FAB89   66:3BCE          CMP CX,SI
 004FAB8C   75 02            JNZ SHORT haloce.004FAB90
 004FAB8E   8BF8             MOV EDI,EAX
 004FAB90   5E               POP ESI
 004FAB91   33C0             XOR EAX,EAX
 004FAB93   85FF             TEST EDI,EDI
 004FAB95   74 13            JE SHORT haloce.004FABAA
 004FAB97   8A4F 03          MOV CL,BYTE PTR DS:[EDI+3]
 004FAB9A   BA 01000000      MOV EDX,1
 004FAB9F   D3E2             SHL EDX,CL
 004FABA1   855424 08        TEST DWORD PTR SS:[ESP+8],EDX
 004FABA5   74 03            JE SHORT haloce.004FABAA
 004FABA7   8B47 08          MOV EAX,DWORD PTR DS:[EDI+8]
 004FABAA   5F               POP EDI
 004FABAB   C3               RETN
<-
004AE13A   83C4 04          ADD ESP,4
004AE13D   85C0             TEST EAX,EAX ;EAX=400AF1F8
004AE13F   74 36            JE SHORT haloce.004AE177
004AE141   8BB8 1C010000    MOV EDI,DWORD PTR DS:[EAX+11C] ;player_obj->veh_obj_tag ->EDI=E2A20033
004AE147   8B5424 10        MOV EDX,DWORD PTR SS:[ESP+10] ;veh obj tag from player sending chat->EDX=E2A20033
004AE14B   3BFA             CMP EDI,EDX ;player in the same veh?
004AE14D   0F94C0           SETE AL ;->AL=01
004AE150   84C0             TEST AL,AL
004AE152   74 23            JE SHORT haloce.004AE177
004AE154   0FBE46 64        MOVSX EAX,BYTE PTR DS:[ESI+64] ;get player chat index (same as player index)
004AE158   83F8 FF          CMP EAX,-1
004AE15B   74 1A            JE SHORT haloce.004AE177
004AE15D   6A 03            PUSH 3
004AE15F   6A 01            PUSH 1
004AE161   6A 00            PUSH 0
004AE163   6A 01            PUSH 1
004AE165   55               PUSH EBP ;EBP=0000009F
004AE166   68 20CE8000      PUSH haloce.0080CE20
004AE16B   6A 01            PUSH 1
004AE16D   8BF3             MOV ESI,EBX ;->ESI=007FC340
004AE16F   E8 6C6F0300      CALL haloce.004E50E0 ;send message to player
004AE174   83C4 1C          ADD ESP,1C ;EAX=00000001 succeded
004AE177   8D7C24 20        LEA EDI,DWORD PTR SS:[ESP+20] ;ptr to player info struct->EDI=0018C85C
004AE17B   E8 90590200      CALL haloce.004D3B10 ;get valid staic player ptr and tag
004AE180   8BF0             MOV ESI,EAX
004AE182   85F6             TEST ESI,ESI
004AE184  ^75 AA            JNZ SHORT haloce.004AE130 ;loop if their are more players

004AE186   5E               POP ESI                                  ; Default case of switch 004AE0D3
004AE187   5D               POP EBP
004AE188   5B               POP EBX
004AE189   5F               POP EDI
004AE18A   81C4 24020000    ADD ESP,224
004AE190   C3               RETN

;chat type 1: team
004AE191   0FB65424 18      MOVZX EDX,BYTE PTR SS:[ESP+18]           ; Case 1 of switch 004AE0D3
004AE196   8B35 C0558100    MOV ESI,DWORD PTR DS:[8155C0]
004AE19C   E8 1F5A0200      CALL haloce.004D3BC0
004AE1A1   3BC7             CMP EAX,EDI
004AE1A3   894424 10        MOV DWORD PTR SS:[ESP+10],EAX
004AE1A7  ^74 DD            JE SHORT haloce.004AE186
004AE1A9   897424 20        MOV DWORD PTR SS:[ESP+20],ESI
004AE1AD   66:897C24 24     MOV WORD PTR SS:[ESP+24],DI
004AE1B2   81F6 72657469    XOR ESI,69746572
004AE1B8   8D7C24 20        LEA EDI,DWORD PTR SS:[ESP+20]
004AE1BC   C74424 28 FFFFFF>MOV DWORD PTR SS:[ESP+28],-1
004AE1C4   897424 2C        MOV DWORD PTR SS:[ESP+2C],ESI
004AE1C8   E8 43590200      CALL haloce.004D3B10
004AE1CD   85C0             TEST EAX,EAX
004AE1CF  ^74 B5            JE SHORT haloce.004AE186
004AE1D1   8B5424 10        MOV EDX,DWORD PTR SS:[ESP+10]
004AE1D5   8B48 20          MOV ECX,DWORD PTR DS:[EAX+20]
004AE1D8   3B4A 20          CMP ECX,DWORD PTR DS:[EDX+20]
004AE1DB   75 23            JNZ SHORT haloce.004AE200
004AE1DD   0FBE40 64        MOVSX EAX,BYTE PTR DS:[EAX+64]
004AE1E1   83F8 FF          CMP EAX,-1
004AE1E4   74 1A            JE SHORT haloce.004AE200
004AE1E6   6A 03            PUSH 3
004AE1E8   6A 01            PUSH 1
004AE1EA   6A 00            PUSH 0
004AE1EC   6A 01            PUSH 1
004AE1EE   55               PUSH EBP
004AE1EF   68 20CE8000      PUSH haloce.0080CE20
004AE1F4   6A 01            PUSH 1
004AE1F6   8BF3             MOV ESI,EBX
004AE1F8   E8 E36E0300      CALL haloce.004E50E0
004AE1FD   83C4 1C          ADD ESP,1C
004AE200   8D7C24 20        LEA EDI,DWORD PTR SS:[ESP+20]
004AE204   E8 07590200      CALL haloce.004D3B10
004AE209   85C0             TEST EAX,EAX
004AE20B  ^75 C4            JNZ SHORT haloce.004AE1D1
004AE20D   5E               POP ESI
004AE20E   5D               POP EBP
004AE20F   5B               POP EBX
004AE210   5F               POP EDI
004AE211   81C4 24020000    ADD ESP,224
004AE217   C3               RETN

;chat type 0: global
004AE218   6A 03            PUSH 3
004AE21A   6A 01            PUSH 1
004AE21C   57               PUSH EDI ;0
004AE21D   6A 01            PUSH 1
004AE21F   68 20CE8000      PUSH haloce.0080CE20
004AE224   6A 01            PUSH 1
004AE226   8BC5             MOV EAX,EBP ;000000AF
004AE228   E8 03700300      CALL haloce.004E5230
004AE22D   83C4 18          ADD ESP,18 ;EAX=01
004AE230   5D               POP EBP
004AE231   5B               POP EBX
004AE232   5F               POP EDI
004AE233   81C4 24020000    ADD ESP,224
004AE239   C3               RETN
;004AE23A   E8 C1200400      CALL haloce.004F0300
;004AE23F   5F               POP EDI
;004AE240   81C4 24020000    ADD ESP,224
;004AE246   C3               RETN

















004F07F0   8B48 08          MOV ECX,DWORD PTR DS:[EAX+8]
004F07F3   53               PUSH EBX
004F07F4   56               PUSH ESI
004F07F5   57               PUSH EDI
004F07F6   33FF             XOR EDI,EDI
004F07F8   83F9 01          CMP ECX,1
004F07FB   8978 40          MOV DWORD PTR DS:[EAX+40],EDI
004F07FE   8978 44          MOV DWORD PTR DS:[EAX+44],EDI
004F0801   75 3B            JNZ SHORT haloce.004F083E
004F0803   8B48 04          MOV ECX,DWORD PTR DS:[EAX+4]
004F0806   8B148D 40BA5F00  MOV EDX,DWORD PTR DS:[ECX*4+5FBA40]
004F080D   8B48 3C          MOV ECX,DWORD PTR DS:[EAX+3C]
004F0810   8B52 20          MOV EDX,DWORD PTR DS:[EDX+20]
004F0813   8B70 0C          MOV ESI,DWORD PTR DS:[EAX+C]
004F0816   8BD9             MOV EBX,ECX
004F0818   83E3 07          AND EBX,7
004F081B   8958 58          MOV DWORD PTR DS:[EAX+58],EBX
004F081E   8BD9             MOV EBX,ECX
004F0820   8948 50          MOV DWORD PTR DS:[EAX+50],ECX
004F0823   8D4C11 FF        LEA ECX,DWORD PTR DS:[ECX+EDX-1]
004F0827   C1EB 03          SHR EBX,3
004F082A   8948 5C          MOV DWORD PTR DS:[EAX+5C],ECX
004F082D   8958 54          MOV DWORD PTR DS:[EAX+54],EBX
004F0830   8978 48          MOV DWORD PTR DS:[EAX+48],EDI
004F0833   8970 4C          MOV DWORD PTR DS:[EAX+4C],ESI
004F0836   8950 60          MOV DWORD PTR DS:[EAX+60],EDX
004F0839   0150 40          ADD DWORD PTR DS:[EAX+40],EDX
004F083C   EB 19            JMP SHORT haloce.004F0857
004F083E   33D2             XOR EDX,EDX
004F0840   8D48 48          LEA ECX,DWORD PTR DS:[EAX+48]
004F0843   8911             MOV DWORD PTR DS:[ECX],EDX
004F0845   8951 04          MOV DWORD PTR DS:[ECX+4],EDX
004F0848   8951 08          MOV DWORD PTR DS:[ECX+8],EDX
004F084B   8951 0C          MOV DWORD PTR DS:[ECX+C],EDX
004F084E   8951 10          MOV DWORD PTR DS:[ECX+10],EDX
004F0851   8951 14          MOV DWORD PTR DS:[ECX+14],EDX
004F0854   8951 18          MOV DWORD PTR DS:[ECX+18],EDX
004F0857   8B70 40          MOV ESI,DWORD PTR DS:[EAX+40]
004F085A   8B48 3C          MOV ECX,DWORD PTR DS:[EAX+3C]
004F085D   8B50 18          MOV EDX,DWORD PTR DS:[EAX+18]
004F0860   03CE             ADD ECX,ESI
004F0862   2BD6             SUB EDX,ESI
004F0864   8B70 0C          MOV ESI,DWORD PTR DS:[EAX+C]
004F0867   8BD9             MOV EBX,ECX
004F0869   83E3 07          AND EBX,7
004F086C   8958 74          MOV DWORD PTR DS:[EAX+74],EBX
004F086F   8BD9             MOV EBX,ECX
004F0871   8978 64          MOV DWORD PTR DS:[EAX+64],EDI
004F0874   8948 6C          MOV DWORD PTR DS:[EAX+6C],ECX
004F0877   5F               POP EDI
004F0878   C1EB 03          SHR EBX,3
004F087B   8970 68          MOV DWORD PTR DS:[EAX+68],ESI
004F087E   8D4C0A FF        LEA ECX,DWORD PTR DS:[EDX+ECX-1]
004F0882   8958 70          MOV DWORD PTR DS:[EAX+70],EBX
004F0885   5E               POP ESI
004F0886   8948 78          MOV DWORD PTR DS:[EAX+78],ECX
004F0889   8950 7C          MOV DWORD PTR DS:[EAX+7C],EDX
004F088C   B0 01            MOV AL,1
004F088E   5B               POP EBX
004F088F   C3               RETN
004F0890   83EC 08          SUB ESP,8
004F0893   53               PUSH EBX
004F0894   55               PUSH EBP
004F0895   56               PUSH ESI
004F0896   8BF0             MOV ESI,EAX
004F0898   8B46 04          MOV EAX,DWORD PTR DS:[ESI+4]
004F089B   8B0C85 40BA5F00  MOV ECX,DWORD PTR DS:[EAX*4+5FBA40]
004F08A2   8B51 1C          MOV EDX,DWORD PTR DS:[ECX+1C]
004F08A5   833A 00          CMP DWORD PTR DS:[EDX],0
004F08A8   57               PUSH EDI
004F08A9   894C24 14        MOV DWORD PTR SS:[ESP+14],ECX
004F08AD   7E 68            JLE SHORT haloce.004F0917
004F08AF   8BC2             MOV EAX,EDX
004F08B1   8B00             MOV EAX,DWORD PTR DS:[EAX]
004F08B3   85C0             TEST EAX,EAX
004F08B5   B3 01            MOV BL,1
004F08B7   7E 5E            JLE SHORT haloce.004F0917
004F08B9   8D6E 64          LEA EBP,DWORD PTR DS:[ESI+64]
004F08BC   33FF             XOR EDI,EDI
004F08BE   894424 10        MOV DWORD PTR SS:[ESP+10],EAX
004F08C2   8B4E 04          MOV ECX,DWORD PTR DS:[ESI+4]
004F08C5   8B148D 40BA5F00  MOV EDX,DWORD PTR DS:[ECX*4+5FBA40]
004F08CC   8B42 1C          MOV EAX,DWORD PTR DS:[EDX+1C]
004F08CF   8B4C38 08        MOV ECX,DWORD PTR DS:[EAX+EDI+8]
004F08D3   8B5424 1C        MOV EDX,DWORD PTR SS:[ESP+1C]
004F08D7   8D4438 08        LEA EAX,DWORD PTR DS:[EAX+EDI+8]
004F08DB   8B40 04          MOV EAX,DWORD PTR DS:[EAX+4]
004F08DE   55               PUSH EBP
004F08DF   03C2             ADD EAX,EDX
004F08E1   50               PUSH EAX
004F08E2   6A 00            PUSH 0
004F08E4   51               PUSH ECX
004F08E5   FF51 50          CALL DWORD PTR DS:[ECX+50]
004F08E8   83C4 10          ADD ESP,10
004F08EB   85C0             TEST EAX,EAX
004F08ED   7E 10            JLE SHORT haloce.004F08FF
004F08EF   8B4E 40          MOV ECX,DWORD PTR DS:[ESI+40]
004F08F2   03C8             ADD ECX,EAX
004F08F4   84DB             TEST BL,BL
004F08F6   894E 40          MOV DWORD PTR DS:[ESI+40],ECX
004F08F9   74 04            JE SHORT haloce.004F08FF
004F08FB   B3 01            MOV BL,1
004F08FD   EB 02            JMP SHORT haloce.004F0901
004F08FF   32DB             XOR BL,BL
004F0901   8B4424 10        MOV EAX,DWORD PTR SS:[ESP+10]
004F0905   83C7 10          ADD EDI,10
004F0908   48               DEC EAX
004F0909   894424 10        MOV DWORD PTR SS:[ESP+10],EAX
004F090D  ^75 B3            JNZ SHORT haloce.004F08C2
004F090F   84DB             TEST BL,BL
004F0911   74 69            JE SHORT haloce.004F097C
004F0913   8B4C24 14        MOV ECX,DWORD PTR SS:[ESP+14]
004F0917   8B51 20          MOV EDX,DWORD PTR DS:[ECX+20]
004F091A   33C0             XOR EAX,EAX
004F091C   B9 10000000      MOV ECX,10
004F0921   BF 10396500      MOV EDI,haloce.00653910
004F0926   F3:AB            REP STOS DWORD PTR ES:[EDI]
004F0928   8B4E 08          MOV ECX,DWORD PTR DS:[ESI+8]
004F092B   BD 01000000      MOV EBP,1
004F0930   3BCD             CMP ECX,EBP
004F0932   0F95C3           SETNE BL
004F0935   33FF             XOR EDI,EDI
004F0937   85D2             TEST EDX,EDX
004F0939   895424 14        MOV DWORD PTR SS:[ESP+14],EDX
004F093D   7E 3D            JLE SHORT haloce.004F097C
004F093F   90               NOP
004F0940   8B4C24 20        MOV ECX,DWORD PTR SS:[ESP+20]
004F0944   8B4424 24        MOV EAX,DWORD PTR SS:[ESP+24]
004F0948   51               PUSH ECX ;0018C850
004F0949   57               PUSH EDI ;2
004F094A   E8 21010000      CALL haloce.004F0A70 ;004F0A70
004F094F   8B4E 08          MOV ECX,DWORD PTR DS:[ESI+8]
004F0952   83C4 08          ADD ESP,8
004F0955   3BCD             CMP ECX,EBP
004F0957   75 0C            JNZ SHORT haloce.004F0965
004F0959   84DB             TEST BL,BL
004F095B   75 04            JNZ SHORT haloce.004F0961
004F095D   84C0             TEST AL,AL
004F095F   74 10            JE SHORT haloce.004F0971
004F0961   B3 01            MOV BL,1
004F0963   EB 0E            JMP SHORT haloce.004F0973
004F0965   84DB             TEST BL,BL
004F0967   74 08            JE SHORT haloce.004F0971
004F0969   84C0             TEST AL,AL
004F096B   74 04            JE SHORT haloce.004F0971
004F096D   B3 01            MOV BL,1
004F096F   EB 02            JMP SHORT haloce.004F0973
004F0971   32DB             XOR BL,BL
004F0973   8B4424 14        MOV EAX,DWORD PTR SS:[ESP+14]
004F0977   47               INC EDI
004F0978   3BF8             CMP EDI,EAX
004F097A  ^7C C4            JL SHORT haloce.004F0940
004F097C   5F               POP EDI
004F097D   5E               POP ESI
004F097E   5D               POP EBP
004F097F   8AC3             MOV AL,BL
004F0981   5B               POP EBX
004F0982   83C4 08          ADD ESP,8
004F0985   C3               RETN






^



004F0A70   53               PUSH EBX
004F0A71   55               PUSH EBP
004F0A72   8B6C24 0C        MOV EBP,DWORD PTR SS:[ESP+C]
004F0A76   57               PUSH EDI
004F0A77   8BF8             MOV EDI,EAX
004F0A79   8B46 04          MOV EAX,DWORD PTR DS:[ESI+4]
004F0A7C   8B1485 40BA5F00  MOV EDX,DWORD PTR DS:[EAX*4+5FBA40]
004F0A83   8BCD             MOV ECX,EBP
004F0A85   C1E1 04          SHL ECX,4
004F0A88   8D440A 28        LEA EAX,DWORD PTR DS:[EDX+ECX+28]
004F0A8C   8B08             MOV ECX,DWORD PTR DS:[EAX]
004F0A8E   8B50 04          MOV EDX,DWORD PTR DS:[EAX+4]
004F0A91   32DB             XOR BL,BL
004F0A93   85FF             TEST EDI,EDI
004F0A95   74 07            JE SHORT haloce.004F0A9E
004F0A97   8B40 08          MOV EAX,DWORD PTR DS:[EAX+8]
004F0A9A   03C7             ADD EAX,EDI
004F0A9C   EB 02            JMP SHORT haloce.004F0AA0
004F0A9E   33C0             XOR EAX,EAX
004F0AA0   8D7E 64          LEA EDI,DWORD PTR DS:[ESI+64]
004F0AA3   57               PUSH EDI
004F0AA4   8B7C24 18        MOV EDI,DWORD PTR SS:[ESP+18]
004F0AA8   03D7             ADD EDX,EDI
004F0AAA   52               PUSH EDX
004F0AAB   50               PUSH EAX
004F0AAC   51               PUSH ECX
004F0AAD   FF51 50          CALL DWORD PTR DS:[ECX+50] ;004ED680
004F0AB0   8BF8             MOV EDI,EAX
004F0AB2   8B46 08          MOV EAX,DWORD PTR DS:[ESI+8]
004F0AB5   83C4 10          ADD ESP,10
004F0AB8   83F8 01          CMP EAX,1
004F0ABB   75 20            JNZ SHORT haloce.004F0ADD
004F0ABD   33C0             XOR EAX,EAX
004F0ABF   33DB             XOR EBX,EBX
004F0AC1   85FF             TEST EDI,EDI
004F0AC3   0F95C0           SETNE AL
004F0AC6   8D56 48          LEA EDX,DWORD PTR DS:[ESI+48]
004F0AC9   50               PUSH EAX
004F0ACA   E8 1124FEFF      CALL haloce.004D2EE0
004F0ACF   83C4 04          ADD ESP,4
004F0AD2   84C0             TEST AL,AL
004F0AD4   74 0D            JE SHORT haloce.004F0AE3
004F0AD6   BB 01000000      MOV EBX,1
004F0ADB   EB 06            JMP SHORT haloce.004F0AE3
004F0ADD   85FF             TEST EDI,EDI
004F0ADF   7E 02            JLE SHORT haloce.004F0AE3
004F0AE1   B3 01            MOV BL,1
004F0AE3   8B4E 44          MOV ECX,DWORD PTR DS:[ESI+44]
004F0AE6   03CF             ADD ECX,EDI
004F0AE8   85FF             TEST EDI,EDI
004F0AEA   894E 44          MOV DWORD PTR DS:[ESI+44],ECX
004F0AED   0F95C1           SETNE CL
004F0AF0   5F               POP EDI
004F0AF1   888D 10396500    MOV BYTE PTR SS:[EBP+653910],CL
004F0AF7   5D               POP EBP
004F0AF8   8AC3             MOV AL,BL
004F0AFA   5B               POP EBX
004F0AFB   C3               RETN


^

004ED680   8B4C24 08        MOV ECX,DWORD PTR SS:[ESP+8]
004ED684   85C9             TEST ECX,ECX
004ED686   8B4424 04        MOV EAX,DWORD PTR SS:[ESP+4]
004ED68A   8B40 58          MOV EAX,DWORD PTR DS:[EAX+58]
004ED68D   74 04            JE SHORT haloce.004ED693
004ED68F   8B11             MOV EDX,DWORD PTR DS:[ECX]
004ED691   EB 02            JMP SHORT haloce.004ED695
004ED693   33D2             XOR EDX,EDX
004ED695   8B4C24 0C        MOV ECX,DWORD PTR SS:[ESP+C]
004ED699   8B09             MOV ECX,DWORD PTR DS:[ECX]
004ED69B   8B00             MOV EAX,DWORD PTR DS:[EAX]
004ED69D   56               PUSH ESI
004ED69E   8B7424 14        MOV ESI,DWORD PTR SS:[ESP+14]
004ED6A2   56               PUSH ESI
004ED6A3   51               PUSH ECX
004ED6A4   52               PUSH EDX
004ED6A5   50               PUSH EAX
004ED6A6   FF50 50          CALL DWORD PTR DS:[EAX+50] ;004ECBA0
004ED6A9   83C4 10          ADD ESP,10
004ED6AC   5E               POP ESI
004ED6AD   C3               RETN

^

;send string as packets
004ECBA0   51               PUSH ECX











