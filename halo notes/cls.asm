;notes by Jesus7Freak
;haloce1.09 ui
;console 004C9BE3

...1 ;inspect
0048D1E3   FF52 0C          CALL DWORD PTR DS:[EDX+C] ;EDX=005F5DD8   haloce.0048C8D0
...2 ;cls
0048D1E3   FF52 0C          CALL DWORD PTR DS:[EDX+C] ;EDX=005F969C   haloce.004853A0
...3 ;inspect
0048D1E3   FF52 0C          CALL DWORD PTR DS:[EDX+C] ;EDX=005F5DD8   haloce.0048C8D0



...2 ;cls
0048D1E3   FF52 0C          CALL DWORD PTR DS:[EDX+C] ;EDX=005F969C   haloce.004853A0
->
004853A0   A0 4CDE6400      MOV AL,BYTE PTR DS:[64DE4C] ;AL=01
004853A5   84C0             TEST AL,AL
004853A7   74 21            JE SHORT haloce.004853CA
004853A9   B8 FFFFFFFF      MOV EAX,-1
004853AE   56               PUSH ESI
004853AF   8B35 50DE6400    MOV ESI,DWORD PTR DS:[64DE50] ;"terminal output"->ESI=0C076918
004853B5   A3 54DE6400      MOV DWORD PTR DS:[64DE54],EAX ;EAX=FFFFFFFF DS:[0064DE54]=E5760002
004853BA   A3 58DE6400      MOV DWORD PTR DS:[64DE58],EAX ;EAX=FFFFFFFF DS:[0064DE58]=E5740000
;clears terminal output (invalidates items as well)
004853BF   E8 FCE60400      CALL haloce.004D3AC0
->
 004D3AC0   57               PUSH EDI
 004D3AC1   6A 02            PUSH 2
 004D3AC3   8D7E 32          LEA EDI,DWORD PTR DS:[ESI+32] ;->EDI=0C07694A
 004D3AC6   56               PUSH ESI
 004D3AC7   57               PUSH EDI
 004D3AC8   66:C746 2E 0000  MOV WORD PTR DS:[ESI+2E],0
 004D3ACE   66:C746 30 0000  MOV WORD PTR DS:[ESI+30],0
 004D3AD4   66:C746 2C 0000  MOV WORD PTR DS:[ESI+2C],0
 004D3ADA   E8 01540F00      CALL haloce.005C8EE0
 ->
  005C8EE0   8B4C24 0C        MOV ECX,DWORD PTR SS:[ESP+C] ;->ECX=00000002
  005C8EE4   57               PUSH EDI
  005C8EE5   85C9             TEST ECX,ECX
  005C8EE7   0F84 92000000    JE haloce.005C8F7F
  005C8EED   56               PUSH ESI
  005C8EEE   53               PUSH EBX
  005C8EEF   8BD9             MOV EBX,ECX ;->EBX=00000002
  005C8EF1   8B7424 14        MOV ESI,DWORD PTR SS:[ESP+14] ;->ESI=0CFD64E8 "terminal output"
  005C8EF5   F7C6 03000000    TEST ESI,3
  005C8EFB   8B7C24 10        MOV EDI,DWORD PTR SS:[ESP+10] ;->EDI=0CFD651A
  005C8EFF   75 0B            JNZ SHORT haloce.005C8F0C
  005C8F01   C1E9 02          SHR ECX,2 ;->ECX=00000000
  005C8F04   0F85 85000000    JNZ haloce.005C8F8F
  005C8F0A   EB 27            JMP SHORT haloce.005C8F33
  ;005C8F0C   8A06             MOV AL,BYTE PTR DS:[ESI]
  ;005C8F0E   83C6 01          ADD ESI,1
  ;005C8F11   8807             MOV BYTE PTR DS:[EDI],AL
  ;005C8F13   83C7 01          ADD EDI,1
  ;005C8F16   83E9 01          SUB ECX,1
  ;005C8F19   74 2B            JE SHORT haloce.005C8F46
  ;005C8F1B   84C0             TEST AL,AL
  ;005C8F1D   74 2F            JE SHORT haloce.005C8F4E
  ;005C8F1F   F7C6 03000000    TEST ESI,3
  ;005C8F25  ^75 E5            JNZ SHORT haloce.005C8F0C
  ;005C8F27   8BD9             MOV EBX,ECX
  ;005C8F29   C1E9 02          SHR ECX,2
  ;005C8F2C   75 61            JNZ SHORT haloce.005C8F8F
  ;005C8F2E   83E3 03          AND EBX,3
  ;005C8F31   74 13            JE SHORT haloce.005C8F46
  005C8F33   8A06             MOV AL,BYTE PTR DS:[ESI] ;->AL=74 't'
  005C8F35   83C6 01          ADD ESI,1 ;"erminal output" ->ESI=0CFD64E9
  005C8F38   8807             MOV BYTE PTR DS:[EDI],AL
  005C8F3A   83C7 01          ADD EDI,1
  005C8F3D   84C0             TEST AL,AL
  005C8F3F   74 37            JE SHORT haloce.005C8F78
  005C8F41   83EB 01          SUB EBX,1 ;->EBX=00000001
  005C8F44  ^75 ED            JNZ SHORT haloce.005C8F33
  005C8F46   8B4424 10        MOV EAX,DWORD PTR SS:[ESP+10] ; 'te'->EAX=0CFD651A
  005C8F4A   5B               POP EBX
  005C8F4B   5E               POP ESI
  005C8F4C   5F               POP EDI
  005C8F4D   C3               RETN
  ;005C8F4E   F7C7 03000000    TEST EDI,3
  ;005C8F54   74 16            JE SHORT haloce.005C8F6C
  ;005C8F56   8807             MOV BYTE PTR DS:[EDI],AL
  ;005C8F58   83C7 01          ADD EDI,1
  ;005C8F5B   83E9 01          SUB ECX,1
  ;005C8F5E   0F84 98000000    JE haloce.005C8FFC
  ;005C8F64   F7C7 03000000    TEST EDI,3
  ;005C8F6A  ^75 EA            JNZ SHORT haloce.005C8F56
  ;005C8F6C   8BD9             MOV EBX,ECX
  ;005C8F6E   C1E9 02          SHR ECX,2
  ;005C8F71   75 74            JNZ SHORT haloce.005C8FE7
  ;005C8F73   8807             MOV BYTE PTR DS:[EDI],AL
  ;005C8F75   83C7 01          ADD EDI,1
  ;005C8F78   83EB 01          SUB EBX,1
  ;005C8F7B  ^75 F6            JNZ SHORT haloce.005C8F73
  ;005C8F7D   5B               POP EBX
  ;005C8F7E   5E               POP ESI
  ;005C8F7F   8B4424 08        MOV EAX,DWORD PTR SS:[ESP+8]
  ;005C8F83   5F               POP EDI
  ;005C8F84   C3               RETN
  ;005C8F85   8917             MOV DWORD PTR DS:[EDI],EDX
  ;005C8F87   83C7 04          ADD EDI,4
  ;005C8F8A   83E9 01          SUB ECX,1
  ;005C8F8D  ^74 9F            JE SHORT haloce.005C8F2E
  ;005C8F8F   BA FFFEFE7E      MOV EDX,7EFEFEFF
  ;005C8F94   8B06             MOV EAX,DWORD PTR DS:[ESI]
  ;005C8F96   03D0             ADD EDX,EAX
  ;005C8F98   83F0 FF          XOR EAX,FFFFFFFF
  ;005C8F9B   33C2             XOR EAX,EDX
  ;005C8F9D   8B16             MOV EDX,DWORD PTR DS:[ESI]
  ;005C8F9F   83C6 04          ADD ESI,4
  ;005C8FA2   A9 00010181      TEST EAX,81010100
  ;005C8FA7  ^74 DC            JE SHORT haloce.005C8F85
  ;005C8FA9   84D2             TEST DL,DL
  ;005C8FAB   74 2C            JE SHORT haloce.005C8FD9
  ;005C8FAD   84F6             TEST DH,DH
  ;005C8FAF   74 1E            JE SHORT haloce.005C8FCF
  ;005C8FB1   F7C2 0000FF00    TEST EDX,0FF0000
  ;005C8FB7   74 0C            JE SHORT haloce.005C8FC5
  ;005C8FB9   F7C2 000000FF    TEST EDX,FF000000
  ;005C8FBF  ^75 C4            JNZ SHORT haloce.005C8F85
  ;005C8FC1   8917             MOV DWORD PTR DS:[EDI],EDX
  ;005C8FC3   EB 18            JMP SHORT haloce.005C8FDD
  ;005C8FC5   81E2 FFFF0000    AND EDX,0FFFF
  ;005C8FCB   8917             MOV DWORD PTR DS:[EDI],EDX
  ;005C8FCD   EB 0E            JMP SHORT haloce.005C8FDD
  ;005C8FCF   81E2 FF000000    AND EDX,0FF
  ;005C8FD5   8917             MOV DWORD PTR DS:[EDI],EDX
  ;005C8FD7   EB 04            JMP SHORT haloce.005C8FDD
  ;005C8FD9   33D2             XOR EDX,EDX
  ;005C8FDB   8917             MOV DWORD PTR DS:[EDI],EDX
  ;005C8FDD   83C7 04          ADD EDI,4
  ;005C8FE0   33C0             XOR EAX,EAX
  ;005C8FE2   83E9 01          SUB ECX,1
  ;005C8FE5   74 0C            JE SHORT haloce.005C8FF3
  ;005C8FE7   33C0             XOR EAX,EAX
  ;005C8FE9   8907             MOV DWORD PTR DS:[EDI],EAX
  ;005C8FEB   83C7 04          ADD EDI,4
  ;005C8FEE   83E9 01          SUB ECX,1
  ;005C8FF1  ^75 F6            JNZ SHORT haloce.005C8FE9
  ;005C8FF3   83E3 03          AND EBX,3
  ;005C8FF6  ^0F85 77FFFFFF    JNZ haloce.005C8F73
  ;005C8FFC   8B4424 10        MOV EAX,DWORD PTR SS:[ESP+10]
  ;005C9000   5B               POP EBX
  ;005C9001   5E               POP ESI
  ;005C9002   5F               POP EDI
  ;005C9003   C3               RETN
 <-
 004D3ADF   66:810F 0080     OR WORD PTR DS:[EDI],8000
 004D3AE4   83C4 0C          ADD ESP,0C
 004D3AE7   33C0             XOR EAX,EAX
 004D3AE9   66:3946 20       CMP WORD PTR DS:[ESI+20],AX
 004D3AED   5F               POP EDI
 004D3AEE   7E 1A            JLE SHORT haloce.004D3B0A
 004D3AF0   0FBF4E 22        MOVSX ECX,WORD PTR DS:[ESI+22]
 004D3AF4   0FBFD0           MOVSX EDX,AX
 004D3AF7   0FAFCA           IMUL ECX,EDX
 004D3AFA   8B56 34          MOV EDX,DWORD PTR DS:[ESI+34]
 004D3AFD   40               INC EAX
 004D3AFE   66:C70411 0000   MOV WORD PTR DS:[ECX+EDX],0
 004D3B04   66:3B46 20       CMP AX,WORD PTR DS:[ESI+20]
 004D3B08  ^7C E6            JL SHORT haloce.004D3AF0
 004D3B0A   C3               RETN
<-
;only for dedicated server that runs in console?
004853C4   E8 F74C0100      CALL haloce.0049A0C0 
->
 0049A0C0   A0 68DE6400      MOV AL,BYTE PTR DS:[64DE68] ;140
 0049A0C5   83EC 20          SUB ESP,20 ;120
 0049A0C8   84C0             TEST AL,AL
 0049A0CA   74 6C            JE SHORT haloce.0049A138
 0049A0CC   8B0D 20DD6400    MOV ECX,DWORD PTR DS:[64DD20] ;hConsoleOutput
 0049A0D2   8D4424 08        LEA EAX,DWORD PTR SS:[ESP+8] ;128
 0049A0D6   50               PUSH EAX ;lpConsoleScreenBufferInfo
 0049A0D7   51               PUSH ECX ;hConsoleOutput
 0049A0D8   66:C74424 08 0000 MOV WORD PTR SS:[ESP+8],0  ;120
 0049A0DF   66:C74424 0A 0000 MOV WORD PTR SS:[ESP+A],0 ;122
 ;Retrieves information about the specified console screen buffer.
 0049A0E6   FF15 00F15D00    CALL DWORD PTR DS:[<&KERNEL32.GetConsole>; kernel32.GetConsoleScreenBufferInfo
 
 0049A0EC   85C0             TEST EAX,EAX
 0049A0EE   74 48            JE SHORT haloce.0049A138
 0049A0F0   0FBF5424 08      MOVSX EDX,WORD PTR SS:[ESP+8] ;128
 0049A0F5   8B0D 20DD6400    MOV ECX,DWORD PTR DS:[64DD20]
 0049A0FB   56               PUSH ESI  ;11C
 0049A0FC   0FBF7424 0E      MOVSX ESI,WORD PTR SS:[ESP+E] ;12A
 0049A101   57               PUSH EDI ;118
 0049A102   0FAFF2           IMUL ESI,EDX
 0049A105   8B7C24 08        MOV EDI,DWORD PTR SS:[ESP+8] ;120
 0049A109   8D4424 0C        LEA EAX,DWORD PTR SS:[ESP+C] ;124
 0049A10D   50               PUSH EAX ;lpNumberOfCharsWritten
 0049A10E   57               PUSH EDI ;dwWriteCoord
 0049A10F   56               PUSH ESI ;nLength
 0049A110   6A 20            PUSH 20 ;cCharacter  20h=' '  
 0049A112   51               PUSH ECX ;hConsoleOutput
 ;Writes a character to the console screen buffer a specified number of times, beginning at the specified coordinates.
 0049A113   FF15 E4F05D00    CALL DWORD PTR DS:[<&KERNEL32.FillConsol>; kernel32.FillConsoleOutputCharacterA
 0049A119   85C0             TEST EAX,EAX
 0049A11B   74 19            JE SHORT haloce.0049A136
 0049A11D   8B4424 18        MOV EAX,DWORD PTR SS:[ESP+18] ;130
 0049A121   8B0D 20DD6400    MOV ECX,DWORD PTR DS:[64DD20]
 0049A127   8D5424 0C        LEA EDX,DWORD PTR SS:[ESP+C] ;124
 0049A12B   52               PUSH EDX ;lpNumberOfCharsWritten
 0049A12C   57               PUSH EDI ;dwWriteCoord
 0049A12D   56               PUSH ESI ;nLength
 0049A12E   50               PUSH EAX ;wAttribute
 0049A12F   51               PUSH ECX ;hConsoleOutput
 ;Sets the character attributes for a specified number of character cells, beginning at the specified coordinates in a screen buffer.
 0049A130   FF15 08F15D00    CALL DWORD PTR DS:[<&KERNEL32.FillConsol>; kernel32.FillConsoleOutputAttribute
 0049A136   5F               POP EDI ;11C
 0049A137   5E               POP ESI ;120
 0049A138   83C4 20          ADD ESP,20 ;140
 0049A13B   C3               RETN
<-
004853C9   5E               POP ESI
004853CA   8B4C24 08        MOV ECX,DWORD PTR SS:[ESP+8]
004853CE   33C0             XOR EAX,EAX
004853D0   E9 BB7F0000      JMP haloce.0048D390
...

0048D390   81E1 FFFF0000    AND ECX,0FFFF
0048D396   56               PUSH ESI
0048D397   8BF1             MOV ESI,ECX
0048D399   8B0D B0558100    MOV ECX,DWORD PTR DS:[8155B0]
0048D39F   69F6 18020000    IMUL ESI,ESI,218
0048D3A5   57               PUSH EDI
0048D3A6   8B79 34          MOV EDI,DWORD PTR DS:[ECX+34]
0048D3A9   8B5437 10        MOV EDX,DWORD PTR DS:[EDI+ESI+10]
0048D3AD   8B4A 04          MOV ECX,DWORD PTR DS:[EDX+4]
0048D3B0   8B15 B4558100    MOV EDX,DWORD PTR DS:[8155B4]
0048D3B6   8B52 34          MOV EDX,DWORD PTR DS:[EDX+34]
0048D3B9   03FE             ADD EDI,ESI
0048D3BB   81E1 FFFF0000    AND ECX,0FFFF
0048D3C1   8D0C89           LEA ECX,DWORD PTR DS:[ECX+ECX*4]
0048D3C4   8D0C8A           LEA ECX,DWORD PTR DS:[EDX+ECX*4]
0048D3C7   F641 06 02       TEST BYTE PTR DS:[ECX+6],2
0048D3CB   0FBF51 02        MOVSX EDX,WORD PTR DS:[ECX+2]
0048D3CF   75 0C            JNZ SHORT haloce.0048D3DD
0048D3D1   8B1495 18416200  MOV EDX,DWORD PTR DS:[EDX*4+624118]
0048D3D8   66:8B12          MOV DX,WORD PTR DS:[EDX]
0048D3DB   EB 16            JMP SHORT haloce.0048D3F3
0048D3DD   6BD2 5C          IMUL EDX,EDX,5C
0048D3E0   53               PUSH EBX
0048D3E1   8B1D 6C226E00    MOV EBX,DWORD PTR DS:[6E226C]
0048D3E7   8B9B A0040000    MOV EBX,DWORD PTR DS:[EBX+4A0]
0048D3ED   66:8B541A 22     MOV DX,WORD PTR DS:[EDX+EBX+22]
0048D3F2   5B               POP EBX
0048D3F3   66:8B49 04       MOV CX,WORD PTR DS:[ECX+4]
0048D3F7   66:3BD1          CMP DX,CX
0048D3FA   74 47            JE SHORT haloce.0048D443
0048D3FC   66:83FA 03       CMP DX,3
0048D400   74 41            JE SHORT haloce.0048D443
0048D402   66:83F9 2B       CMP CX,2B
0048D406   7C 06            JL SHORT haloce.0048D40E
0048D408   66:83F9 30       CMP CX,30
0048D40C   7E 35            JLE SHORT haloce.0048D443
0048D40E   66:83F9 25       CMP CX,25
0048D412   7C 19            JL SHORT haloce.0048D42D
0048D414   66:83F9 2A       CMP CX,2A
0048D418   7F 13            JG SHORT haloce.0048D42D
0048D41A   66:83FA 2B       CMP DX,2B
0048D41E   7C 23            JL SHORT haloce.0048D443
0048D420   66:83FA 30       CMP DX,30
0048D424   7F 1D            JG SHORT haloce.0048D443
0048D426   E8 25DC0600      CALL haloce.004FB050
0048D42B   EB 16            JMP SHORT haloce.0048D443
0048D42D   0FBFC9           MOVSX ECX,CX
0048D430   6BC9 31          IMUL ECX,ECX,31
0048D433   0FBFD2           MOVSX EDX,DX
0048D436   03CA             ADD ECX,EDX
0048D438   50               PUSH EAX
0048D439   FF148D 00726200  CALL DWORD PTR DS:[ECX*4+627200]
0048D440   83C4 04          ADD ESP,4
0048D443   8B4F 10          MOV ECX,DWORD PTR DS:[EDI+10]
0048D446   8B11             MOV EDX,DWORD PTR DS:[ECX]
0048D448   8B4A 08          MOV ECX,DWORD PTR DS:[EDX+8]
0048D44B   8B15 B0558100    MOV EDX,DWORD PTR DS:[8155B0]
0048D451   8901             MOV DWORD PTR DS:[ECX],EAX
0048D453   8B42 34          MOV EAX,DWORD PTR DS:[EDX+34]
0048D456   8B4C30 10        MOV ECX,DWORD PTR DS:[EAX+ESI+10]
0048D45A   8B11             MOV EDX,DWORD PTR DS:[ECX]
0048D45C   03C6             ADD EAX,ESI
0048D45E   5F               POP EDI
0048D45F   8950 10          MOV DWORD PTR DS:[EAX+10],EDX
0048D462   5E               POP ESI
0048D463   C3               RETN



