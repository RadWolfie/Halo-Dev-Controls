;notes by Jesus7Freak
;haloce1.09 p0 rpg_beta6_2 rp_h1
;console 004C9BE3

...1 ;inspect
0048D1E3   FF52 0C          CALL DWORD PTR DS:[EDX+C] ;EDX=005F5DD8   haloce.0048C8D0
...2 ;object_create_anew
0048D1E3   FF52 0C          CALL DWORD PTR DS:[EDX+C] ;EDX=005F5F80   haloce.0047D430
...3 ;object_create_anew
0048D1E3   FF52 0C          CALL DWORD PTR DS:[EDX+C] ;EDX=005F5F80   haloce.0047D430
...4 ;inspect
0048D1E3   FF52 0C          CALL DWORD PTR DS:[EDX+C] ;EDX=005F5DD8   haloce.0048C8D0


...2
0048D1E3   FF52 0C          CALL DWORD PTR DS:[EDX+C] ;EDX=005F5F80   haloce.0047D430
->
0047D430   0FBF4424 04      MOVSX EAX,WORD PTR SS:[ESP+4] ;->EAX=00000028
0047D435   8B0485 18416200  MOV EAX,DWORD PTR DS:[EAX*4+624118] ;dev list->EAX=005F5F80
0047D43C   8B4C24 0C        MOV ECX,DWORD PTR SS:[ESP+C] ;->ECX=403D9901
0047D440   56               PUSH ESI
0047D441   8B7424 0C        MOV ESI,DWORD PTR SS:[ESP+C] ;->ESI=F374000A
0047D445   51               PUSH ECX
0047D446   8D50 1C          LEA EDX,DWORD PTR DS:[EAX+1C] ;->EDX=005F5F9C
0047D449   0FBF40 1A        MOVSX EAX,WORD PTR DS:[EAX+1A] ;->EAX=00000001
0047D44D   52               PUSH EDX
0047D44E   50               PUSH EAX
0047D44F   56               PUSH ESI
0047D450   E8 4B010100      CALL haloce.0048D5A0
0047D455   83C4 10          ADD ESP,10
0047D458   85C0             TEST EAX,EAX ;EAX=00000000
0047D45A   74 18            JE SHORT haloce.0047D474
;0047D45C   33C9             XOR ECX,ECX
;0047D45E   66:8B08          MOV CX,WORD PTR DS:[EAX]
;0047D461   51               PUSH ECX
;0047D462   E8 09D60000      CALL haloce.0048AA70
;0047D467   83C4 04          ADD ESP,4
;0047D46A   8BCE             MOV ECX,ESI
;0047D46C   33C0             XOR EAX,EAX
;0047D46E   5E               POP ESI
;0047D46F   E9 1CFF0000      JMP haloce.0048D390
0047D474   5E               POP ESI
0047D475   C3               RETN



...3
0048D1E3   FF52 0C          CALL DWORD PTR DS:[EDX+C] ;EDX=005F5F80   haloce.0047D430
->
0047D430   0FBF4424 04      MOVSX EAX,WORD PTR SS:[ESP+4] ;->EAX=00000028
0047D435   8B0485 18416200  MOV EAX,DWORD PTR DS:[EAX*4+624118] ;->EAX=005F5F80
0047D43C   8B4C24 0C        MOV ECX,DWORD PTR SS:[ESP+C] ;->ECX=403D9900
0047D440   56               PUSH ESI
0047D441   8B7424 0C        MOV ESI,DWORD PTR SS:[ESP+C] ;->ESI=F374000A
0047D445   51               PUSH ECX
0047D446   8D50 1C          LEA EDX,DWORD PTR DS:[EAX+1C] ;->EDX=005F5F9C
0047D449   0FBF40 1A        MOVSX EAX,WORD PTR DS:[EAX+1A] ;->EAX=00000001
;get ptr to param info
0047D44D   52               PUSH EDX
0047D44E   50               PUSH EAX
0047D44F   56               PUSH ESI
0047D450   E8 4B010100      CALL haloce.0048D5A0
0047D455   83C4 10          ADD ESP,10

0047D458   85C0             TEST EAX,EAX ;EAX=403D9A3A
0047D45A   74 18            JE SHORT haloce.0047D474
0047D45C   33C9             XOR ECX,ECX
0047D45E   66:8B08          MOV CX,WORD PTR DS:[EAX] ;->CX=0009    (index of rp_h1 in scripted objs list)
0047D461   51               PUSH ECX
0047D462   E8 09D60000      CALL haloce.0048AA70
->
 0048AA70   56               PUSH ESI
 0048AA71   8B7424 08        MOV ESI,DWORD PTR SS:[ESP+8] ;->ESI=00000009
 0048AA75   66:83FE FF       CMP SI,0FFFF ;== -1?
 0048AA79   74 55            JE SHORT haloce.0048AAD0
 0048AA7B   66:85F6          TEST SI,SI ; == 0?
 0048AA7E   7C 48            JL SHORT haloce.0048AAC8
 0048AA80   66:81FE 0002     CMP SI,200 ; >= size?
 0048AA85   7D 27            JGE SHORT haloce.0048AAAE
 0048AA87   8B0D 083C6500    MOV ECX,DWORD PTR DS:[653C08] ;->ECX=402567BC
 0048AA8D   0FBFC6           MOVSX EAX,SI ;->EAX=00000009
 0048AA90   57               PUSH EDI
 0048AA91   8B3C81           MOV EDI,DWORD PTR DS:[ECX+EAX*4] ;->EDI=FFFFFFFF   (obj tag)
 0048AA94   83FF FF          CMP EDI,-1
 0048AA97   74 14            JE SHORT haloce.0048AAAD
 ;test if players are in veh
 0048AA99   57               PUSH EDI
 0048AA9A   E8 C1FEFFFF      CALL haloce.0048A960
 0048AA9F   83C4 04          ADD ESP,4
 0048AAA2   84C0             TEST AL,AL
 0048AAA4   75 07            JNZ SHORT haloce.0048AAAD
 ;destroy obj func
 0048AAA6   8BC7             MOV EAX,EDI
 0048AAA8   E8 B3ED0600      CALL haloce.004F9860
 
 0048AAAD   5F               POP EDI
 0048AAAE   66:85F6          TEST SI,SI
 0048AAB1   7C 15            JL SHORT haloce.0048AAC8
 0048AAB3   66:81FE 0002     CMP SI,200
 0048AAB8   7D 0E            JGE SHORT haloce.0048AAC8
 0048AABA   A1 083C6500      MOV EAX,DWORD PTR DS:[653C08] ;->EAX=402567BC
 0048AABF   0FBFD6           MOVSX EDX,SI ;->EDX=00000009
 0048AAC2   833C90 FF        CMP DWORD PTR DS:[EAX+EDX*4],-1 ;DS:[402567E0]=FFFFFFFF (funny, it already tested this...)
 0048AAC6   75 08            JNZ SHORT haloce.0048AAD0
 0048AAC8   8BCE             MOV ECX,ESI ;->ECX=00000009
 0048AACA   5E               POP ESI
 0048AACB   E9 30050700      JMP haloce.004FB000 ;instead of calling obj create jmp to it
 ;0048AAD0   5E               POP ESI
 ;0048AAD1   C3               RETN
 ...
 004FB000   A1 6C226E00      MOV EAX,DWORD PTR DS:[6E226C] ;->EAX=40479E80 "psbs"
 004FB005   8B90 08020000    MOV EDX,DWORD PTR DS:[EAX+208] ;->EDX=4047AA80  "p2_x" (sptr to names and data)
 004FB00B   0FBFC9           MOVSX ECX,CX ;->ECX=00000009
 004FB00E   8D0CC9           LEA ECX,DWORD PTR DS:[ECX+ECX*8] ;->ECX=00000051
 004FB011   56               PUSH ESI
 004FB012   8D348A           LEA ESI,DWORD PTR DS:[EDX+ECX*4] ;->ESI=4047ABC4 "rp_h1"
 
 004FB015   0FBF4E 20        MOVSX ECX,WORD PTR DS:[ESI+20] ;->ECX=00000001  (data?)
 004FB019   8B0C8D A4766300  MOV ECX,DWORD PTR DS:[ECX*4+6376A4] ;->ECX=00636C80
 
 004FB020   0FBF76 22        MOVSX ESI,WORD PTR DS:[ESI+22] ;->ESI=00000002 (more data?)
 004FB024   0FBF51 0C        MOVSX EDX,WORD PTR DS:[ECX+C] ;->EDX=0000024C 
 004FB028   57               PUSH EDI
 004FB029   0FBF79 0E        MOVSX EDI,WORD PTR DS:[ECX+E] ;->EDI=00000078  
 004FB02D   0FBF49 0A        MOVSX ECX,WORD PTR DS:[ECX+A] ;->ECX=00000240
 004FB031   0FAFFE           IMUL EDI,ESI ;->EDI=000000F0
 004FB034   8B7401 04        MOV ESI,DWORD PTR DS:[ECX+EAX+4] ;->ESI=4047F484
 004FB038   03D0             ADD EDX,EAX ;->EDX=4047A0CC
 
 ;          (struct size 120 or 78h)
 ;4047F574->0009 0000 (scripted obj index)
 ;          00000000
 ;          C1DF3FFD x -27.9062442779541 (spawn coordinates)
 ;          4470AFA1 y 962.7442016601562
 ;          BE5A1F1E z -0.2130093276500702
 ;          00000000 * 17 (all zeros)
 ;          0F0F 0000
 ;          00000000 * 7 (all zeros)
 
 ;          (struct size 72 or 48h)
 ;4047A0CC->0000 0009 (scripted obj index)
 ;          40481374->69 68 65 76 "ihev" (struct size 48 or 30h)
 ;                    4045A5C8->00000000 * 21 (all zeros)
 ;                              76000000
 ;                              ansi string "vehicles\warthog\bitmaps\warthog chaingun multipurpose"
 ;                    00000000
 ;                    E2A40130 obj type tag"biped tag"
 ;                    00000000 * 8 (all zeros)
 ;          00000000 * 16 (all zeros)
 004FB03A   03FE             ADD EDI,ESI ;->EDI=4047F574
 004FB03C   52               PUSH EDX ;4047A0CC 
 004FB03D   E8 BE270000      CALL haloce.004FD800
 ->
  004FD800   66:8B17          MOV DX,WORD PTR DS:[EDI] ;->DX=0000
  004FD803   81EC 88000000    SUB ESP,88
  004FD809   53               PUSH EBX
  004FD80A   83C8 FF          OR EAX,FFFFFFFF
  004FD80D   66:83FA FF       CMP DX,0FFFF ;== -1?
  004FD811   56               PUSH ESI
  004FD812   0F84 C9000000    JE haloce.004FD8E1
  004FD818   8B0D 0C3C6500    MOV ECX,DWORD PTR DS:[653C0C] ;->ECX=40256724
  004FD81E   8039 00          CMP BYTE PTR DS:[ECX],0
  004FD821   74 0A            JE SHORT haloce.004FD82D
  ;004FD823   F647 04 01       TEST BYTE PTR DS:[EDI+4],1
  ;004FD827   0F85 B4000000    JNZ haloce.004FD8E1
  004FD82D   66:8B4F 02       MOV CX,WORD PTR DS:[EDI+2] ;->CX=0009 (scripted obj index)
  004FD831   66:83F9 FF       CMP CX,0FFFF ;== -1?
  004FD835   74 1F            JE SHORT haloce.004FD856
  004FD837   66:85C9          TEST CX,CX ;== 0?
  004FD83A   7C 1A            JL SHORT haloce.004FD856
  004FD83C   66:81F9 0002     CMP CX,200 ; >= size?
  004FD841   7D 13            JGE SHORT haloce.004FD856
  004FD843   8B35 083C6500    MOV ESI,DWORD PTR DS:[653C08] ;->ESI=402567BC
  004FD849   0FBFC9           MOVSX ECX,CX ;->ECX=00000009
  004FD84C   833C8E FF        CMP DWORD PTR DS:[ESI+ECX*4],-1 ;DS:[402567E0]=FFFFFFFF     (scripted obj tag)
  004FD850   0F85 8B000000    JNZ haloce.004FD8E1
  004FD856   0FBFCA           MOVSX ECX,DX ;->ECX=00000000
  004FD859   8B9424 94000000  MOV EDX,DWORD PTR SS:[ESP+94] ;->EDX=4047A0CC
  004FD860   8B72 04          MOV ESI,DWORD PTR DS:[EDX+4] ;->ESI=40481374
  004FD863   8D0C49           LEA ECX,DWORD PTR DS:[ECX+ECX*2] ;->ECX=00000000
  004FD866   C1E1 04          SHL ECX,4 ;->ECX=00000000
  004FD869   03CE             ADD ECX,ESI ;->ECX=40481374
  004FD86B   8B49 0C          MOV ECX,DWORD PTR DS:[ECX+C] ;->ECX=E2A40130 "biped tag"
  004FD86E   83F9 FF          CMP ECX,-1
  004FD871   74 6E            JE SHORT haloce.004FD8E1
  004FD873   6A FF            PUSH -1
  004FD875   51               PUSH ECX
  004FD876   8D4424 10        LEA EAX,DWORD PTR SS:[ESP+10] ;->EAX=0018CE24->005F5F80
  004FD87A   E8 B1B7FFFF      CALL haloce.004F9030
  004FD87F   8D47 08          LEA EAX,DWORD PTR DS:[EDI+8] ;->EAX=4047F57C
  004FD882   8B08             MOV ECX,DWORD PTR DS:[EAX] ;->ECX=C1DF3FFD x coord -27.9062442779541
  004FD884   8B50 04          MOV EDX,DWORD PTR DS:[EAX+4] ;->EDX=4470AFA1 y coord 962.7442016601562
  004FD887   8B40 08          MOV EAX,DWORD PTR DS:[EAX+8] ;->EAX=BE5A1F1E z coord -0.2130093276500702
  004FD88A   895424 2C        MOV DWORD PTR SS:[ESP+2C],EDX
  004FD88E   894424 30        MOV DWORD PTR SS:[ESP+30],EAX
  004FD892   83C4 08          ADD ESP,8
  004FD895   8D47 14          LEA EAX,DWORD PTR DS:[EDI+14] ;->EAX=4047F588
  004FD898   8D5424 48        LEA EDX,DWORD PTR SS:[ESP+48] ;->EDX=0018CE64
  004FD89C   8D7424 3C        LEA ESI,DWORD PTR SS:[ESP+3C] ;->ESI=0018CE58
  004FD8A0   894C24 20        MOV DWORD PTR SS:[ESP+20],ECX
  004FD8A4   E8 773AFDFF      CALL haloce.004D1320
  004FD8A9   66:8B4F 06       MOV CX,WORD PTR DS:[EDI+6] ;->CX=0000
  004FD8AD   66:894C24 1E     MOV WORD PTR SS:[ESP+1E],CX
  004FD8B2   8D4C24 08        LEA ECX,DWORD PTR SS:[ESP+8] ;->ECX=0018CE24
  004FD8B6   E8 35B8FFFF      CALL haloce.004F90F0
  ->
   004F90F0   66:833D D0476B00 02 CMP WORD PTR DS:[6B47D0],2 ;DS:[006B47D0]=0002 server check?
   004F90F8   56               PUSH ESI
   004F90F9   B8 03000000      MOV EAX,3
   004F90FE   75 27            JNZ SHORT haloce.004F9127
   004F9100   8B11             MOV EDX,DWORD PTR DS:[ECX] ;->EDX=E2A40130 "biped tag"
   004F9102   8B35 E46D8100    MOV ESI,DWORD PTR DS:[816DE4] ;->ESI=40440028
   004F9108   81E2 FFFF0000    AND EDX,0FFFF ;->EDX=0000130
   004F910E   C1E2 05          SHL EDX,5 ;->EDX=00002600
   004F9111   8B5432 14        MOV EDX,DWORD PTR DS:[EDX+ESI+14] ;->EDX=4061F898
   004F9115   0FBF12           MOVSX EDX,WORD PTR DS:[EDX] ;->EDX=00000001
   004F9118   8B1495 A4766300  MOV EDX,DWORD PTR DS:[EDX*4+6376A4] ;->EDX=00636C80
   004F911F   837A 10 FF       CMP DWORD PTR DS:[EDX+10],-1 ;DS:[00636C90]=00000005
   004F9123   74 02            JE SHORT haloce.004F9127
   004F9125   33C0             XOR EAX,EAX
   ;create object
   004F9127   50               PUSH EAX ;00000000
   004F9128   51               PUSH ECX ;0018CE24 ptr to "biped tag and other data"
   004F9129   E8 12000000      CALL haloce.004F9140
   004F912E   83C4 08          ADD ESP,8
   004F9131   5E               POP ESI
   004F9132   C3               RETN
  <-
  004FD8BB   8BF0             MOV ESI,EAX ;->EAX=E431000D new obj tag
  004FD8BD   83FE FF          CMP ESI,-1
  004FD8C0   74 1D            JE SHORT haloce.004FD8DF
  004FD8C2   57               PUSH EDI
  004FD8C3   56               PUSH ESI
  004FD8C4   E8 E7A2FFFF      CALL haloce.004F7BB0
  ->
   004F7BB0   8B0D B0B37F00         MOV ECX,DWORD PTR DS:[7FB3B0] ;"object"
   004F7BB6   8B51 34               MOV EDX,DWORD PTR DS:[ECX+34]
   004F7BB9   53                    PUSH EBX
   004F7BBA   8B5C24 08             MOV EBX,DWORD PTR SS:[ESP+8]
   004F7BBE   8BC3                  MOV EAX,EBX
   004F7BC0   25 FFFF0000           AND EAX,0FFFF
   004F7BC5   8D0440                LEA EAX,DWORD PTR DS:[EAX+EAX*2]
   004F7BC8   8B4482 08             MOV EAX,DWORD PTR DS:[EDX+EAX*4+8] ;object 
   004F7BCC   0FBF88 B4000000       MOVSX ECX,WORD PTR DS:[EAX+B4] ;object.B4 -> ECX=00000001
   004F7BD3   55                    PUSH EBP
   004F7BD4   8B6C24 10             MOV EBP,DWORD PTR SS:[ESP+10]
   004F7BD8   56                    PUSH ESI
   004F7BD9   57                    PUSH EDI
   004F7BDA   8B3C8D A4766300       MOV EDI,DWORD PTR DS:[ECX*4+6376A4] ;->EDI=00636C80
   004F7BE1   8B8F 80000000         MOV ECX,DWORD PTR DS:[EDI+80] ;->ECX=00636A28
   004F7BE7   8D87 80000000         LEA EAX,DWORD PTR DS:[EDI+80] ;->EAX=00636D00
   004F7BED   33F6                  XOR ESI,ESI
   004F7BEF   85C9                  TEST ECX,ECX
   004F7BF1   74 26                 JE SHORT haloce.004F7C19
   004F7BF3   8B00                  /MOV EAX,DWORD PTR DS:[EAX] ;->EAX=00636A28
   004F7BF5   8B40 2C               |MOV EAX,DWORD PTR DS:[EAX+2C] ;->EAX=00000000
   004F7BF8   85C0                  |TEST EAX,EAX
   004F7BFA   74 07                 |JE SHORT haloce.004F7C03
   ;004F7BFC   55                    |PUSH EBP
   ;004F7BFD   53                    |PUSH EBX
   ;004F7BFE   FFD0                  |CALL EAX
   ;004F7C00   83C4 08               |ADD ESP,8
   004F7C03   46                    |INC ESI
   004F7C04   0FBFD6                |MOVSX EDX,SI ;->EDX=00000001
   004F7C07   8B8C97 80000000       |MOV ECX,DWORD PTR DS:[EDI+EDX*4+80] ;->ECX=00636AF0
   004F7C0E   85C9                  |TEST ECX,ECX ;loop until zero
   004F7C10   8D8497 80000000       |LEA EAX,DWORD PTR DS:[EDI+EDX*4+80] ;->EAX=00636D04
   004F7C17  ^75 DA                 \JNZ SHORT haloce.004F7BF3
   004F7C19   5F                    POP EDI
   004F7C1A   5E                    POP ESI
   004F7C1B   5D                    POP EBP
   004F7C1C   5B                    POP EBX
   004F7C1D   C3                    RETN
  <-
  004FD8C9   33C9             XOR ECX,ECX
  004FD8CB   66:8B4F 02       MOV CX,WORD PTR DS:[EDI+2] ; scripted obj index->CX=0009
  004FD8CF   83C4 08          ADD ESP,8
  004FD8D2   66:83F9 FF       CMP CX,0FFFF
  004FD8D6   74 07            JE SHORT haloce.004FD8DF
  004FD8D8   8BD6             MOV EDX,ESI ;->EDX=E431000D  new obj tag
  ;update the scripted obj tag array
  004FD8DA   E8 71FEFFFF      CALL haloce.004FD750
  ->
   004FD750   56                    PUSH ESI
   004FD751   8B35 B0B37F00         MOV ESI,DWORD PTR DS:[7FB3B0] ;"object"
   004FD757   8B76 34               MOV ESI,DWORD PTR DS:[ESI+34]
   004FD75A   8BC2                  MOV EAX,EDX
   004FD75C   25 FFFF0000           AND EAX,0FFFF
   004FD761   8D0440                LEA EAX,DWORD PTR DS:[EAX+EAX*2]
   004FD764   8B7486 08             MOV ESI,DWORD PTR DS:[ESI+EAX*4+8] ;->ESI=400E4954   obj
   004FD768   57                    PUSH EDI
   004FD769   8B3D 083C6500         MOV EDI,DWORD PTR DS:[653C08] ;scripted obj tag array ptr;->EDI=402567BC
   004FD76F   0FBFC1                MOVSX EAX,CX ;->EAX=00000009 ;index
   004FD772   8D0487                LEA EAX,DWORD PTR DS:[EDI+EAX*4] ;->EAX=402567E0
   004FD775   8338 FF               CMP DWORD PTR DS:[EAX],-1
   004FD778   75 09                 JNZ SHORT haloce.004FD783
   004FD77A   8910                  MOV DWORD PTR DS:[EAX],EDX ;change to new obj tag
   004FD77C   66:898E BA000000      MOV WORD PTR DS:[ESI+BA],CX ;obj.BA = scripted obj index
   004FD783   5F                    POP EDI
   004FD784   5E                    POP ESI
   004FD785   C3                    RETN
  <-
  004FD8DF   8BC6             MOV EAX,ESI ;ret new obj tag->EAX=E431000D
  004FD8E1   5E               POP ESI
  004FD8E2   5B               POP EBX
  004FD8E3   81C4 88000000    ADD ESP,88
  004FD8E9   C3               RETN
 <-
 004FB042   83C4 04          ADD ESP,4
 
 004FB045   5F               POP EDI
 004FB046   5E               POP ESI
 004FB047   C3               RETN
<-
0047D467   83C4 04          ADD ESP,4

0047D46A   8BCE             MOV ECX,ESI
0047D46C   33C0             XOR EAX,EAX
0047D46E   5E               POP ESI
0047D46F   E9 1CFF0000      JMP haloce.0048D390
0047D474   5E               POP ESI
0047D475   C3               RETN

